<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="单词浏览">
    <meta name="keywords" content="单词浏览,单词浏览">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>单词浏览</title>
    <link rel="stylesheet" crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">

    <style>
        .glassbga {
            /*渐变*/
            background: linear-gradient(to right bottom, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.2));
            ;
            border-radius: 1rem;
            box-shadow: 6px 6px 10px rgba(112, 112, 112, 0.2);
        }

        .glassbg {
            background: linear-gradient(to right top, #65dfc9, #6cdbeb);
            border-radius: 1rem;
        }

        .circle-ab {
            background: linear-gradient(to right bottom, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.2));
            height: 14rem;
            width: 14rem;
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
        }

        .circle1 {
            top: 0%;
            right: 13%;
        }

        .circle2 {
            bottom: 6%;
            left: 13%;
        }
    </style>


</head>
<!--
    抽奖功能v1
    圆形排列
    8个人名
-->

<body id="q-app" class="glassbg text-white  ">
    <!--悬浮球-->
    <div class="circle1 circle-ab"> </div>
    <div class="circle2 circle-ab"></div>
    <!---上面的结果框val--->
    <div class="container ">
        <div class="mt-2 row justify-content-center  ">
            <div class="w-100 mb-5   d-none d-md-block"><!---高度垫子 小设备隐藏--></div>
            <div :class="{'animate__animated  animate__bounceInUp':pd.showLucky}">
                <h3>检查</h3>
            </div>
            <div class="w-100 mb-5   d-none d-md-block"><!---高度垫子 小设备隐藏--></div>
        </div>
    </div>
    <!--抽奖盘-->
    <div class=" container   glassbga ">
        <div class=" d-flex    align-items-center  justify-content-center " style="height: 200px;">

            <span class=" shadow    badge badge-light badge-pill">内部 </span>
            <span class=" shadow   badge-primary  badge   badge-pill">内部2 </span>
            <span class=" shadow   badge-info badge   badge-pill">内部2 </span>


        </div>
        <div class=" d-flex     align-items-center  justify-content-center " style="height: 200px;">

            <span class=" shadow    badge badge-light badge-pill">内部 </span>
            <span class="    badge-secondary badge   badge-pill">内部2 </span>
            <span class=" shadow   badge-info badge   badge-pill">内部2 </span>


        </div>
    </div>
    <!--底部按钮-->
    <div class="fixed-bottom row justify-content-center rounded   ">
        <div class=" d-flex  col-md-5 col-sm-8   bg-warning glassbga  justify-content-around ">
            <label for="exampleInputPassword1" class="text-dark d-flex  align-items-center  ">页码</label>
            <input type="text" class="w-25 form-control">
            <button ref="ref_login_manage" @click="er.emit('读取.单词',this) " class="btn shadow-lg btn-danger">跳转
            </button>
            <button @click="er.emit('遮罩',1) " class="btn shadow-lg shadow btn-danger">输入名单
                <span class="position-absolute badge badge-light badge-pill" v-text="pd.nameSize"> </span>
            </button>
     
        </div>
        <div class="w-100 mb-5   d-none d-md-block"><!---高度垫子 小设备隐藏--></div>
    </div>


    <!---遮罩--->
    <div v-if="pd.sp==0?false:true" @click="er.emit('遮罩',0) " style="z-index: 1040  ;" class=" modal-backdrop show ">
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.47/vue.global.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.2/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/EventEmitter/5.2.8/EventEmitter.min.js"></script>



    <script>
        const er = new EventEmitter //事件线
        const { onMounted, emits, createApp, ref, watch, computed } = Vue

        const gd = {};//全局数据 解决调用引用问题
        const pd = ref({ "load": [] }); //特殊变量，页面数据
        const pvs = pd.value; //变量代理访问
        gd.pd = pd;//page data 页面元素引用"数据"
        gd.storage = {
            //本地浏览器 存取组件
            set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            },
            get(key) {
                return JSON.parse(localStorage.getItem(key));
            },
            remove(key) {
                localStorage.removeItem(key);
            },
        }

        class pgui {
            /* 界面控制类 初始化界面默认值 */
            constructor(arg) {
                this.pd = gd.pd //页面数据
                pvs.load.unshift('pgui')//从开头添加一个值
                pvs.sp = 0; //遮罩路由 (0.无，1.名单，2.登入 ,3.管理)
                this.init();

                this.initManage();
                //绑定事件
                er.on("读取.单词", this.getRow)
                er.on('收到.单词', this.signing)
                er.on('遮罩', this.spto)
            }
            init() {
                //初始效果
                pvs.namesText = ''  //输入框值
                pvs.startBut = false;//开始按钮状态
                pvs.showLucky = 0;//显示动画
            }

            initManage() {
                //管理相关相关界面
                pvs.manage = {};//相关数据
                this.pd.refManageEmt = ref(null);//登入/管理按钮元素

            }

            getRow(e) {
                //console.log('getRow==',e,this.$refs,e.$refs)
                //获取数据，发送请求
                var url = "http://127.0.0.1:2028/jsonapi/get";
                //url = "http://127.0.0.1:2028/jsonapi";
                var ja = {}
                var data = { "单个词表": ja };
                ja['@limit'] = 1
                var opt = {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    body: JSON.stringify(data),
                    "headers": {
                        'Content-Type': 'application/json'
                    }
                }
                //发送
                fetch(url, opt)
                    .then(res => res.json())
                    .catch(this.signErr)
                    .then(dat => er.emit('收到.单词', dat))
                    ;
                //动画效果

                gd.oui.loginLoading(0)

            }
            loginLoading(n) {
                //登入中效果
                this.pd.value.loginLoding = n
            }
            spto(n) {
                var that = gd.oin
                /*切换界面*/
                pvs.sp = n
                //清除提示
                pvs.login_info = ''
            }
            signErr(error) {
                //登入错误处理
                var that = gd.oin
                pvs.login_info = "登入出现错误"
                console.log('Error:', error);
                gd.oui.loginLoading(1)   //loading
            }
            signing(dat) {
                console.log('Sign已经请求', dat);
                gd.oui.loginLoading(1) //loading 

            }

            change2manage() {
                //转向成管理
                pvs.email = gd.storage.get('ue')
                var emt = this.pd.refManageEmt.value
                emt.innerHTML = "管理"
                emt.onclick = () => { gd.oui.spto(3) }
            }
            change2login() {
                //转向成登入
                var emt = this.pd.refManageEmt.value
                emt.innerHTML = "登入"
                emt.onclick = () => { gd.oui.spto(2) }
            }


            watchPg(newValue, oldValue) {
                //watch
                console.log('gd pagedata 被修改')
                //console.log('gd pagedata 被修改\n', newValue, '\n', oldValue)
            }
        }

        //----------开始
        let appdat = {
            setup() {

                const oui = new pgui(); //界面更改"方法"
                //const ocls = new cls(12);//默认选择
                //---放入全局解决this问题
                //gd.ocls = ocls; //抽奖类
                //gd.oin = oin; //通信逻辑
                gd.oui = oui; //ui界面


                watch(pd, oui.watchPg, { deep: true });
                //computed(() => { return JSON.parse(JSON.stringify(pvs)); }); //对值二次计算
                //const oin = new login();


                //onMounted(() => ocls.bindEvt()); //窗口大小变动事件

                //onMounted(() => oui.remount()); //已经登入刷新处理
                //--变量到html的绑定 js访问要加.value
                return { er, pd, oui, "ref_login_manage": pd.refManageEmt, }
            }
        }
        const app = createApp(appdat)
        //app.use(Quasar) //vue的ui
        app.mount('#q-app')
    </script>





</body>

</html>